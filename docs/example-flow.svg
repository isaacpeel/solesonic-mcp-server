<svg aria-roledescription="sequence" role="graphics-document document" viewBox="-86.5 -10 1061.5 911"
         style="max-width: 1061.5px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"
         width="100%" id="_r_c_">
        <g>
            <rect class="actor actor-bottom" ry="3" rx="3" name="A" height="65" width="175" stroke="#666" fill="#eaeaea"
                  y="825" x="750"></rect>
            <text style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: inherit;"
                  class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="857.5" x="837.5">
                <tspan dy="0" x="837.5">Authorization Server</tspan>
            </text>
        </g>
        <g>
            <rect class="actor actor-bottom" ry="3" rx="3" name="M" height="65" width="252" stroke="#666" fill="#eaeaea"
                  y="825" x="448"></rect>
            <text style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: inherit;"
                  class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="857.5" x="574">
                <tspan dy="0" x="574">MCP Server (Resource Server)</tspan>
            </text>
        </g>
        <g>
            <rect class="actor actor-bottom" ry="3" rx="3" name="C" height="65" width="150" stroke="#666" fill="#eaeaea"
                  y="825" x="0"></rect>
            <text style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: inherit;"
                  class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="857.5" x="75">
                <tspan dy="0" x="75">Client</tspan>
            </text>
        </g>
        <g>
            <line name="A" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="825" x2="837.5" y1="65"
                  x1="837.5" id="actor2"></line>
            <g id="root-2">
                <rect class="actor actor-top" ry="3" rx="3" name="A" height="65" width="175" stroke="#666"
                      fill="#eaeaea" y="0" x="750"></rect>
                <text style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: inherit;"
                      class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5"
                      x="837.5">
                    <tspan dy="0" x="837.5">Authorization Server</tspan>
                </text>
            </g>
        </g>
        <g>
            <line name="M" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="825" x2="574" y1="65" x1="574"
                  id="actor1"></line>
            <g id="root-1">
                <rect class="actor actor-top" ry="3" rx="3" name="M" height="65" width="252" stroke="#666"
                      fill="#eaeaea" y="0" x="448"></rect>
                <text style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: inherit;"
                      class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="574">
                    <tspan dy="0" x="574">MCP Server (Resource Server)</tspan>
                </text>
            </g>
        </g>
        <g>
            <line name="C" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="825" x2="75" y1="65" x1="75"
                  id="actor0"></line>
            <g id="root-0">
                <rect class="actor actor-top" ry="3" rx="3" name="C" height="65" width="150" stroke="#666"
                      fill="#eaeaea" y="0" x="0"></rect>
                <text style="text-anchor: middle; font-size: 16px; font-weight: 400; font-family: inherit;"
                      class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75">
                    <tspan dy="0" x="75">Client</tspan>
                </text>
            </g>
        </g>
        <style>#_r_c_ {
            font-family: inherit;
            font-size: 16px;
            fill: #ccc;
        }

        #_r_c_ .error-icon {
            fill: #a44141;
        }

        #_r_c_ .error-text {
            fill: #ddd;
            stroke: #ddd;
        }

        #_r_c_ .edge-thickness-normal {
            stroke-width: 1px;
        }

        #_r_c_ .edge-thickness-thick {
            stroke-width: 3.5px;
        }

        #_r_c_ .edge-pattern-solid {
            stroke-dasharray: 0;
        }

        #_r_c_ .edge-thickness-invisible {
            stroke-width: 0;
            fill: none;
        }

        #_r_c_ .edge-pattern-dashed {
            stroke-dasharray: 3;
        }

        #_r_c_ .edge-pattern-dotted {
            stroke-dasharray: 2;
        }

        #_r_c_ .marker {
            fill: lightgrey;
            stroke: lightgrey;
        }

        #_r_c_ .marker.cross {
            stroke: lightgrey;
        }

        #_r_c_ svg {
            font-family: inherit;
            font-size: 16px;
        }

        #_r_c_ p {
            margin: 0;
        }

        #_r_c_ .actor {
            stroke: #ccc;
            fill: #1f2020;
        }

        #_r_c_ text.actor& gt

        ;
        tspan {
            fill: lightgrey;
            stroke: none;
        }

        #_r_c_ .actor-line {
            stroke: #ccc;
        }

        #_r_c_ .messageLine0 {
            stroke-width: 1.5;
            stroke-dasharray: none;
            stroke: lightgrey;
        }

        #_r_c_ .messageLine1 {
            stroke-width: 1.5;
            stroke-dasharray: 2, 2;
            stroke: lightgrey;
        }

        #_r_c_ #arrowhead path {
            fill: lightgrey;
            stroke: lightgrey;
        }

        #_r_c_ .sequenceNumber {
            fill: black;
        }

        #_r_c_ #sequencenumber {
            fill: lightgrey;
        }

        #_r_c_ #crosshead path {
            fill: lightgrey;
            stroke: lightgrey;
        }

        #_r_c_ .messageText {
            fill: lightgrey;
            stroke: none;
        }

        #_r_c_ .labelBox {
            stroke: #ccc;
            fill: #1f2020;
        }

        #_r_c_ .labelText, #_r_c_ .labelText& gt

        ;
        tspan {
            fill: lightgrey;
            stroke: none;
        }

        #_r_c_ .loopText, #_r_c_ .loopText& gt

        ;
        tspan {
            fill: lightgrey;
            stroke: none;
        }

        #_r_c_ .loopLine {
            stroke-width: 2px;
            stroke-dasharray: 2, 2;
            stroke: #ccc;
            fill: #ccc;
        }

        #_r_c_ .note {
            stroke: hsl(180, 0%, 18.3529411765%);
            fill: hsl(180, 1.5873015873%, 28.3529411765%);
        }

        #_r_c_ .noteText, #_r_c_ .noteText& gt

        ;
        tspan {
            fill: rgb(183.8476190475, 181.5523809523, 181.5523809523);
            stroke: none;
        }

        #_r_c_ .activation0 {
            fill: hsl(180, 1.5873015873%, 28.3529411765%);
            stroke: #ccc;
        }

        #_r_c_ .activation1 {
            fill: hsl(180, 1.5873015873%, 28.3529411765%);
            stroke: #ccc;
        }

        #_r_c_ .activation2 {
            fill: hsl(180, 1.5873015873%, 28.3529411765%);
            stroke: #ccc;
        }

        #_r_c_ .actorPopupMenu {
            position: absolute;
        }

        #_r_c_ .actorPopupMenuPanel {
            position: absolute;
            fill: #1f2020;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            filter: drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));
        }

        #_r_c_ .actor-man line {
            stroke: #ccc;
            fill: #1f2020;
        }

        #_r_c_ .actor-man circle, #_r_c_ line {
            stroke: #ccc;
            fill: #1f2020;
            stroke-width: 2px;
        }

        #_r_c_ :root {
            --mermaid-font-family: inherit;
        }</style>
        <g></g>
        <defs>
            <symbol height="24" width="24" id="computer">
                <path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"
                      transform="scale(.5)"></path>
            </symbol>
        </defs>
        <defs>
            <symbol clip-rule="evenodd" fill-rule="evenodd" id="database">
                <path d="M12.2...(13131 characters truncated, it's impossible to view or edit this line)
                      transform="scale(.5)"></path>
            </symbol>
        </defs>
        <defs>
            <symbol height="24" width="24" id="clock">
                <path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"
                      transform="scale(.5)"></path>
            </symbol>
        </defs>
        <defs>
            <marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5"
                    refX="7.9" id="arrowhead">
                <path d="M -1 0 L 10 5 L 0 10 z"></path>
            </marker>
        </defs>
        <defs>
            <marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead">
                <path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000"
                      fill="none"></path>
            </marker>
        </defs>
        <defs>
            <marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head">
                <path d="M 18,7 L9,13 L14,7 L9,1 Z"></path>
            </marker>
        </defs>
        <defs>
            <marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber">
                <circle r="6" cy="15" cx="15"></circle>
            </marker>
        </defs>
        <g>
            <rect class="note" height="60" width="223" stroke="#666" fill="#EDF2AE" y="175" x="-36.5"></rect>
            <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="noteText"
                  alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="180" x="75">
                <tspan x="75">Extract resource_metadata</tspan>
            </text>
            <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="noteText"
                  alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="200" x="75">
                <tspan x="75">from WWW-Authenticate</tspan>
            </text>
        </g>
        <g>
            <rect class="note" height="60" width="194" stroke="#666" fill="#EDF2AE" y="345" x="-22"></rect>
            <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="noteText"
                  alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="350" x="75">
                <tspan x="75">Validate RS metadata,</tspan>
            </text>
            <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="noteText"
                  alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="370" x="75">
                <tspan x="75">build AS metadata URL</tspan>
            </text>
        </g>
        <g>
            <rect class="note" height="40" width="812.5" stroke="#666" fill="#EDF2AE" y="515" x="50"></rect>
            <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="noteText"
                  alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="520" x="456">
                <tspan x="456">OAuth 2.1 authorization flow happens here</tspan>
            </text>
        </g>
        <g>
            <rect class="note" height="40" width="549" stroke="#666" fill="#EDF2AE" y="765" x="50"></rect>
            <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="noteText"
                  alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="770" x="325">
                <tspan x="325">MCP communication continues with valid token</tspan>
            </text>
        </g>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="323">MCP request
            without token
        </text>
        <line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0"
              y2="115" x2="570" y1="115" x1="76"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="130" x="326">HTTP 401
            Unauthorized with WWW-Authenticate header
        </text>
        <line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2"
              class="messageLine1" y2="165" x2="79" y1="165" x1="573"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="250" x="323">GET
            /.well-known/oauth-protected-resource
        </text>
        <line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0"
              y2="285" x2="570" y1="285" x1="76"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="300" x="326">Resource
            metadata with authorization server URL
        </text>
        <line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2"
              class="messageLine1" y2="335" x2="79" y1="335" x1="573"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="420" x="455">GET
            /.well-known/oauth-authorization-server
        </text>
        <line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0"
              y2="455" x2="833.5" y1="455" x1="76"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="470" x="458">Authorization
            server metadata
        </text>
        <line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2"
              class="messageLine1" y2="505" x2="79" y1="505" x1="836.5"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="570" x="455">Token request
        </text>
        <line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0"
              y2="605" x2="833.5" y1="605" x1="76"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="620" x="458">Access token
        </text>
        <line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2"
              class="messageLine1" y2="655" x2="79" y1="655" x1="836.5"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="670" x="323">MCP request
            with access token
        </text>
        <line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0"
              y2="705" x2="570" y1="705" x1="76"></line>
        <text style="font-family: inherit; font-size: 16px; font-weight: 400;" dy="1em" class="messageText"
              alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="720" x="326">MCP response
        </text>
        <line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2"
              class="messageLine1" y2="755" x2="79" y1="755" x1="573"></line>
    </svg>